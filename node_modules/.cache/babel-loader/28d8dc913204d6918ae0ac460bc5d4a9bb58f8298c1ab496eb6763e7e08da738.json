{"ast":null,"code":"// Reemplaza Firebase por JWT propio\nimport axios from 'axios';\nconst API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:3001';\nconst TOKEN_KEY = 'app.token';\nconst USER_KEY = 'app.user';\nfunction _saveSession(token, user) {\n  localStorage.setItem(TOKEN_KEY, token);\n  localStorage.setItem(USER_KEY, JSON.stringify(user));\n}\nexport function getToken() {\n  return localStorage.getItem(TOKEN_KEY);\n}\nexport function getUser() {\n  const u = localStorage.getItem(USER_KEY);\n  return u ? JSON.parse(u) : null;\n}\nexport async function registerUser(email, password) {\n  try {\n    await axios.post(`${API_BASE}/register`, {\n      email,\n      password\n    });\n    const {\n      data\n    } = await axios.post(`${API_BASE}/login`, {\n      email,\n      password\n    });\n    if (data !== null && data !== void 0 && data.token) {\n      _saveSession(data.token, data.user);\n      _notify();\n      return {\n        success: true,\n        user: data.user\n      };\n    }\n    return {\n      success: false,\n      error: 'No se recibió token'\n    };\n  } catch (error) {\n    var _error$response, _error$response$data;\n    return {\n      success: false,\n      error: (error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.error) || 'Error al registrar'\n    };\n  }\n}\nexport async function loginUser(email, password) {\n  try {\n    const {\n      data\n    } = await axios.post(`${API_BASE}/login`, {\n      email,\n      password\n    });\n    if (data !== null && data !== void 0 && data.token) {\n      _saveSession(data.token, data.user);\n      _notify();\n      return {\n        success: true,\n        user: data.user\n      };\n    }\n    return {\n      success: false,\n      error: 'No se recibió token'\n    };\n  } catch (error) {\n    var _error$response2, _error$response2$data;\n    return {\n      success: false,\n      error: (error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.error) || 'Error de login'\n    };\n  }\n}\nexport async function logoutUser() {\n  try {\n    localStorage.removeItem(TOKEN_KEY);\n    localStorage.removeItem(USER_KEY);\n    _notify();\n    return {\n      success: true\n    };\n  } catch {\n    return {\n      success: false,\n      error: 'No se pudo cerrar sesión'\n    };\n  }\n}\n\n// Emula onAuthStateChanged de Firebase\nconst listeners = new Set();\nexport function onAuthStateChange(callback) {\n  listeners.add(callback);\n  callback(getUser()); // dispara con el estado actual\n  return () => listeners.delete(callback);\n}\nfunction _notify() {\n  const user = getUser();\n  listeners.forEach(cb => cb(user));\n}","map":{"version":3,"names":["axios","API_BASE","process","env","REACT_APP_API_BASE","TOKEN_KEY","USER_KEY","_saveSession","token","user","localStorage","setItem","JSON","stringify","getToken","getItem","getUser","u","parse","registerUser","email","password","post","data","_notify","success","error","_error$response","_error$response$data","response","loginUser","_error$response2","_error$response2$data","logoutUser","removeItem","listeners","Set","onAuthStateChange","callback","add","delete","forEach","cb"],"sources":["C:/Users/DELL/Desktop/login/login/src/firebase/auth.js"],"sourcesContent":["// Reemplaza Firebase por JWT propio\r\nimport axios from 'axios';\r\n\r\nconst API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:3001';\r\n\r\nconst TOKEN_KEY = 'app.token';\r\nconst USER_KEY = 'app.user';\r\n\r\nfunction _saveSession(token, user) {\r\n  localStorage.setItem(TOKEN_KEY, token);\r\n  localStorage.setItem(USER_KEY, JSON.stringify(user));\r\n}\r\n\r\nexport function getToken() {\r\n  return localStorage.getItem(TOKEN_KEY);\r\n}\r\n\r\nexport function getUser() {\r\n  const u = localStorage.getItem(USER_KEY);\r\n  return u ? JSON.parse(u) : null;\r\n}\r\n\r\nexport async function registerUser(email, password) {\r\n  try {\r\n    await axios.post(`${API_BASE}/register`, { email, password });\r\n    const { data } = await axios.post(`${API_BASE}/login`, { email, password });\r\n    if (data?.token) {\r\n      _saveSession(data.token, data.user);\r\n      _notify();\r\n      return { success: true, user: data.user };\r\n    }\r\n    return { success: false, error: 'No se recibió token' };\r\n  } catch (error) {\r\n    return { success: false, error: error?.response?.data?.error || 'Error al registrar' };\r\n  }\r\n}\r\n\r\nexport async function loginUser(email, password) {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE}/login`, { email, password });\r\n    if (data?.token) {\r\n      _saveSession(data.token, data.user);\r\n      _notify();\r\n      return { success: true, user: data.user };\r\n    }\r\n    return { success: false, error: 'No se recibió token' };\r\n  } catch (error) {\r\n    return { success: false, error: error?.response?.data?.error || 'Error de login' };\r\n  }\r\n}\r\n\r\nexport async function logoutUser() {\r\n  try {\r\n    localStorage.removeItem(TOKEN_KEY);\r\n    localStorage.removeItem(USER_KEY);\r\n    _notify();\r\n    return { success: true };\r\n  } catch {\r\n    return { success: false, error: 'No se pudo cerrar sesión' };\r\n  }\r\n}\r\n\r\n// Emula onAuthStateChanged de Firebase\r\nconst listeners = new Set();\r\nexport function onAuthStateChange(callback) {\r\n  listeners.add(callback);\r\n  callback(getUser()); // dispara con el estado actual\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\nfunction _notify() {\r\n  const user = getUser();\r\n  listeners.forEach(cb => cb(user));\r\n}\r\n"],"mappings":"AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,QAAQ,GAAGC,OAAO,CAACC,GAAG,CAACC,kBAAkB,IAAI,uBAAuB;AAE1E,MAAMC,SAAS,GAAG,WAAW;AAC7B,MAAMC,QAAQ,GAAG,UAAU;AAE3B,SAASC,YAAYA,CAACC,KAAK,EAAEC,IAAI,EAAE;EACjCC,YAAY,CAACC,OAAO,CAACN,SAAS,EAAEG,KAAK,CAAC;EACtCE,YAAY,CAACC,OAAO,CAACL,QAAQ,EAAEM,IAAI,CAACC,SAAS,CAACJ,IAAI,CAAC,CAAC;AACtD;AAEA,OAAO,SAASK,QAAQA,CAAA,EAAG;EACzB,OAAOJ,YAAY,CAACK,OAAO,CAACV,SAAS,CAAC;AACxC;AAEA,OAAO,SAASW,OAAOA,CAAA,EAAG;EACxB,MAAMC,CAAC,GAAGP,YAAY,CAACK,OAAO,CAACT,QAAQ,CAAC;EACxC,OAAOW,CAAC,GAAGL,IAAI,CAACM,KAAK,CAACD,CAAC,CAAC,GAAG,IAAI;AACjC;AAEA,OAAO,eAAeE,YAAYA,CAACC,KAAK,EAAEC,QAAQ,EAAE;EAClD,IAAI;IACF,MAAMrB,KAAK,CAACsB,IAAI,CAAC,GAAGrB,QAAQ,WAAW,EAAE;MAAEmB,KAAK;MAAEC;IAAS,CAAC,CAAC;IAC7D,MAAM;MAAEE;IAAK,CAAC,GAAG,MAAMvB,KAAK,CAACsB,IAAI,CAAC,GAAGrB,QAAQ,QAAQ,EAAE;MAAEmB,KAAK;MAAEC;IAAS,CAAC,CAAC;IAC3E,IAAIE,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEf,KAAK,EAAE;MACfD,YAAY,CAACgB,IAAI,CAACf,KAAK,EAAEe,IAAI,CAACd,IAAI,CAAC;MACnCe,OAAO,CAAC,CAAC;MACT,OAAO;QAAEC,OAAO,EAAE,IAAI;QAAEhB,IAAI,EAAEc,IAAI,CAACd;MAAK,CAAC;IAC3C;IACA,OAAO;MAAEgB,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAAsB,CAAC;EACzD,CAAC,CAAC,OAAOA,KAAK,EAAE;IAAA,IAAAC,eAAA,EAAAC,oBAAA;IACd,OAAO;MAAEH,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE,CAAAA,KAAK,aAALA,KAAK,wBAAAC,eAAA,GAALD,KAAK,CAAEG,QAAQ,cAAAF,eAAA,wBAAAC,oBAAA,GAAfD,eAAA,CAAiBJ,IAAI,cAAAK,oBAAA,uBAArBA,oBAAA,CAAuBF,KAAK,KAAI;IAAqB,CAAC;EACxF;AACF;AAEA,OAAO,eAAeI,SAASA,CAACV,KAAK,EAAEC,QAAQ,EAAE;EAC/C,IAAI;IACF,MAAM;MAAEE;IAAK,CAAC,GAAG,MAAMvB,KAAK,CAACsB,IAAI,CAAC,GAAGrB,QAAQ,QAAQ,EAAE;MAAEmB,KAAK;MAAEC;IAAS,CAAC,CAAC;IAC3E,IAAIE,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEf,KAAK,EAAE;MACfD,YAAY,CAACgB,IAAI,CAACf,KAAK,EAAEe,IAAI,CAACd,IAAI,CAAC;MACnCe,OAAO,CAAC,CAAC;MACT,OAAO;QAAEC,OAAO,EAAE,IAAI;QAAEhB,IAAI,EAAEc,IAAI,CAACd;MAAK,CAAC;IAC3C;IACA,OAAO;MAAEgB,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAAsB,CAAC;EACzD,CAAC,CAAC,OAAOA,KAAK,EAAE;IAAA,IAAAK,gBAAA,EAAAC,qBAAA;IACd,OAAO;MAAEP,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE,CAAAA,KAAK,aAALA,KAAK,wBAAAK,gBAAA,GAALL,KAAK,CAAEG,QAAQ,cAAAE,gBAAA,wBAAAC,qBAAA,GAAfD,gBAAA,CAAiBR,IAAI,cAAAS,qBAAA,uBAArBA,qBAAA,CAAuBN,KAAK,KAAI;IAAiB,CAAC;EACpF;AACF;AAEA,OAAO,eAAeO,UAAUA,CAAA,EAAG;EACjC,IAAI;IACFvB,YAAY,CAACwB,UAAU,CAAC7B,SAAS,CAAC;IAClCK,YAAY,CAACwB,UAAU,CAAC5B,QAAQ,CAAC;IACjCkB,OAAO,CAAC,CAAC;IACT,OAAO;MAAEC,OAAO,EAAE;IAAK,CAAC;EAC1B,CAAC,CAAC,MAAM;IACN,OAAO;MAAEA,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAA2B,CAAC;EAC9D;AACF;;AAEA;AACA,MAAMS,SAAS,GAAG,IAAIC,GAAG,CAAC,CAAC;AAC3B,OAAO,SAASC,iBAAiBA,CAACC,QAAQ,EAAE;EAC1CH,SAAS,CAACI,GAAG,CAACD,QAAQ,CAAC;EACvBA,QAAQ,CAACtB,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;EACrB,OAAO,MAAMmB,SAAS,CAACK,MAAM,CAACF,QAAQ,CAAC;AACzC;AAEA,SAASd,OAAOA,CAAA,EAAG;EACjB,MAAMf,IAAI,GAAGO,OAAO,CAAC,CAAC;EACtBmB,SAAS,CAACM,OAAO,CAACC,EAAE,IAAIA,EAAE,CAACjC,IAAI,CAAC,CAAC;AACnC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}